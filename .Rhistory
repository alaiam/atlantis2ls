devtools::load_all(".")
devtools::document()
warnings()
outputs.nc <-open_main_nc(path, prefix = prefix)
path = "C:/Users/Alaia/Desktop/Postdoc/R script/atlantis2ls/data"
prefix = "AMPS"
fg.file = "C:/Users/Alaia/Desktop/Postdoc/R script/atlantis2ls/data/PugetSoundAtlantisFunctionalGroups_salmon_rectype4.csv"
bio.prm = "C:/Users/Alaia/Desktop/Postdoc/R script/atlantis2ls/data/AMPSbioparam_mv1_2022.prm"
bio.prm2 = "C:/Users/Alaia/Desktop/Postdoc/R script/atlantis2ls/data/AMPSbioparam_mv1_20222.prm"
outputs.nc <-open_main_nc(path, prefix = prefix)
devtools::load_all(".")
devtools::load_all(".")
outputs.nc <-open_main_nc(path, prefix = prefix)
vn <- names(outputs.nc$var)[grep("_ResN",outputs.nc$var)]
Ndat <- purrr::map(1:length(vn), function(x) ncdf4::ncvar_get(outputs.nc,vn[x]))
Ndat
names(Ndat)<- vn
vn
outputs.nc <-open_main_nc(path, prefix = prefix)
vn <- names(outputs.nc$var)[grep("_ResN",outputs.nc$var)]
data_Res <- purrr::map(1:length(vn), function(x) ncdf4::ncvar_get(outputs.nc,vn[x]))
names(data_Res)<- vn
vn <- names(outputs.nc$var)[grep("_StructN",outputs.nc$var)]
data_Str <- purrr::map(1:length(vn), function(x) ncdf4::ncvar_get(outputs.nc,vn[x]))
names(data_Str)<- vn
data_Str
names(data_Str)<- vn
data_Str
totnums <-nums %>% purrr::map(apply,MARGIN=3,FUN=sum) # total numbers by age group, time
vn <- names(outputs.nc$var)[grep("_Nums",outputs.nc$var)]
data_Nums <- purrr::map(1:length(vn), function(x) ncdf4::ncvar_get(outputs.nc,vn[x]))
names(data_Nums)<- vn
data_Nums
totnums <-data_Nums %>% purrr::map(apply,MARGIN=3,FUN=sum) # total numbers by age group, time
totnums
relnums <- purrr::map2(nums,totnums,sweep,MARGIN=3,FUN=`/`) # divide nums by totnums along the time axis to get relative annual nums per age group/box/layer
relnums <- purrr::map2(data_Nums,totnums,sweep,MARGIN=3,FUN=`/`) # divide nums by totnums along the time axis to get relative annual nums per age group/box/layer
relnums
wgt =(resN*relnums+strucN*relnums)*20*5.7/1e6
wgt =(data_Res*relnums+data_Str*relnums)*20*5.7/1e6
data_Res
relnums
(data_Res*relnums+data_Str*relnums)
relnums
View(relnums)
wgt =(purrr::map2(data_Res,relnums,`*`)+purrr::map2(data_Str,relnums,`*`))*20*5.7/1e6
purrr::map2(data_Res,relnums,`*`)
(purrr::map2(data_Res,relnums,`*`)+purrr::map2(data_Str,relnums,`*`))%>%
purrr::map(apply,MARGIN=3,FUN=sum)
(purrr::map2(data_Res,relnums,`*`)+purrr::map2(data_Str,relnums,`*`))
purrr::map2(data_Res,relnums,`*`)
data_Str
purrr::map2(data_Str,relnums,`*`)
wgt = (purrr::map2(data_Res,relnums,`*`)*20*5.7/1e6 + purrr::map2(data_Str,relnums,`*`))*20*5.7/1e6 %>%
purrr::map(apply,MARGIN=3,FUN=sum)
(purrr::map2(data_Res,relnums,20*5.7/1e6,`*`)
)
purrr::map2(data_Res,relnums,`*`)
purrr::map2(purrr::map2(data_Res,relnums,`*`), purrr::map2(data_Res,relnums,`*`), `+`)
wgt = lapply(purrr::map2(purrr::map2(data_Res,relnums,`*`), purrr::map2(data_Res,relnums,`*`), `+`),"*",20*5.7/1e6)
wgt
wgt = lapply(purrr::map2(purrr::map2(data_Res,relnums,`*`), purrr::map2(data_Res,relnums,`*`), `+`),"*",20*5.7/1e6)%>%
purrr::map(apply,MARGIN=3,FUN=sum)
wgt
wgt = lapply(purrr::map2(purrr::map2(data_Str,relnums,`*`), purrr::map2(data_Res,relnums,`*`), `+`),"*",20*5.7/1e6)%>%
purrr::map(apply,MARGIN=3,FUN=sum)
wgt
devtools::load_all(".")
a <- extract_waa(path = path, prefix = prefix)
a
devtools::load_all(".")
read_atlantis(path = path, prefix = prefix, fg.file = fg.file)
data <- extract_abundance_grp(path, prefix = prefix)
i.species = grep(species,names(data))
species = "CHY"
i.species = grep(species,names(data))
i.species
if (length(i.species)){
return(Reduce('+', data[i.species]))
}else{
return(NA)
}
length(i.species)
devtools::load_all(".")
read_atlantis(path = path, prefix = prefix, fg.file = fg.file)
a <- extract_waa(path=path, prefix = prefix)
# a lot of lines to actually read the data
output = list(biomass= extract_biomass_main(path = path, prefix = prefix, fg.file = fg.file),
landings=extract_catch_main(path, prefix = prefix, fg.file, fishery = F),
abundance= extract_abund_main(path, prefix = prefix, fg.file),
waa = extract_waa)
devtools::load_all(".")
read_atlantis(path = path, prefix = prefix, fg.file = fg.file)
devtools::load_all(".")
a <- read_atlantis(path = path, prefix = prefix, fg.file = fg.file)
path = "C:/Users/Alaia/Desktop/Postdoc/R script/atlantis2ls/data"
prefix = "AMPS"
fg.file = "C:/Users/Alaia/Desktop/Postdoc/R script/atlantis2ls/data/PugetSoundAtlantisFunctionalGroups_salmon_rectype4.csv"
bio.prm = "C:/Users/Alaia/Desktop/Postdoc/R script/atlantis2ls/data/AMPSbioparam_mv1_2022.prm"
bio.prm2 = "C:/Users/Alaia/Desktop/Postdoc/R script/atlantis2ls/data/AMPSbioparam_mv1_20222.prm"
devtools::load_all(".")
a <- read_atlantis(path = path, prefix = prefix, fg.file = fg.file)
outputs.nc <-open_main_nc(path, prefix = prefix)
fg <- process_fg(fg.file)
vn <- c(paste0(fg$Name,"_N")) # variable name is functional group + "_N"
ts <- ncdf4::ncvar_get(outputs.nc,varid = "t") %>% as.numeric
tyrs <- ts/(60*60*24*365) # from s to yrs
Ndat <- purrr::map(1:length(vn), function(x) ncdf4::ncvar_get(outputs.nc,vn[x]))
vn <- c(paste0(fg$Name,"_N"))
vn
fg
fg$Name[fg$IsTurnedOn==1]
outputs.nc <-open_main_nc(path, prefix = prefix)
fg <- process_fg(fg.file)
vn <- c(paste0(fg$Name,"_N")) # variable name is functional group + "_N"
ts <- ncdf4::ncvar_get(outputs.nc,varid = "t") %>% as.numeric
tyrs <- ts/(60*60*24*365) # from s to yrs
Ndat <- purrr::map(1:length(vn), function(x) ncdf4::ncvar_get(outputs.nc,vn[x]))
names(Ndat)<- vn
a <- read_atlantis(path = path, prefix = prefix, fg.file = fg.file)
a
# a <- read_atlantis(path = path, prefix = prefix, fg.file = fg.file)
a[atlantis.biomass["Sm_Plank_Fish"]]
# a <- read_atlantis(path = path, prefix = prefix, fg.file = fg.file)
a.biomass["Sm_Plank_Fish"]
atlantis.biomass = a$biomass
atlantis.abundance = a$abundance
atlantis.meanSizeByAge = a$meanSizeByAge
atlantis.biomass
a$waa
##########################################################################################
# Process the outputs so that calibrar like them
output = list(
# Biomass
Sm_Plank_Fish.biomass = atlantis.biomass[,"Sm_Plank_Fish"],
Gadiods_Fish.biomass = atlantis.biomass[,"Gadiods_Fish"],
Raptors.biomass = atlantis.biomass[,"Raptors"],
Trans_Orcas.biomass = atlantis.biomass[,"Trans_Orcas"],
NorwayPout.biomass = atlantis.biomass[,"NorwayPout"],
Lrg_Phyto.biomass = atlantis.biomass[,"Lrg_Phyto"],
CommonSole.biomass = atlantis.biomass[,"CommonSole"],
Saithe.biomass = atlantis.biomass[,"Saithe"],
AtlanticCod.biomass = atlantis.biomass[,"AtlanticCod"],
Haddock.biomass = atlantis.biomass[,"Haddock"],
HorseMackerel.biomass = atlantis.biomass[,"HorseMackerel"],
Whiting.biomass = atlantis.biomass[,"Whiting"],
CommonDab.biomass = atlantis.biomass[,"CommonDab"],
GreyGurnard.biomass = atlantis.biomass[,"GreyGurnard"],
Hake.biomass = atlantis.biomass[,"Hake"],
# Thr
Sm_Plank_Fish.Thr = atlantis.biomass[,"Sm_Plank_Fish"],
Gadiods_Fish.Thr = atlantis.biomass[,"Gadiods_Fish"],
Raptors.Thr = atlantis.biomass[,"Raptors"],
Trans_Orcas.Thr = atlantis.biomass[,"Trans_Orcas"],
NorwayPout.Thr = atlantis.biomass[,"NorwayPout"],
Lrg_Phyto.Thr = atlantis.biomass[,"Lrg_Phyto"],
CommonSole.Thr = atlantis.biomass[,"CommonSole"],
Saithe.Thr = atlantis.biomass[,"Saithe"],
AtlanticCod.Thr = atlantis.biomass[,"AtlanticCod"],
Haddock.Thr = atlantis.biomass[,"Haddock"],
HorseMackerel.Thr = atlantis.biomass[,"HorseMackerel"],
Whiting.Thr = atlantis.biomass[,"Whiting"],
CommonDab.Thr = atlantis.biomass[,"CommonDab"],
GreyGurnard.Thr = atlantis.biomass[,"GreyGurnard"],
Hake.Thr = atlantis.biomass[,"Hake"],
# Landings
Sm_Plank_Fish.landings = atlantis.landings[,"Sm_Plank_Fish"],
Gadiods_Fish.landings = atlantis.landings[,"Gadiods_Fish"],
Raptors.landings = atlantis.landings[,"Raptors"],
Trans_Orcas.landings = atlantis.landings[,"Trans_Orcas"],
NorwayPout.landings = atlantis.landings[,"NorwayPout"],
Lrg_Phyto.landings = atlantis.landings[,"Lrg_Phyto"],
CommonSole.landings = atlantis.landings[,"CommonSole"],
Saithe.landings = atlantis.landings[,"Saithe"],
AtlanticCod.landings = atlantis.landings[,"AtlanticCod"],
Haddock.landings = atlantis.landings[,"Haddock"],
HorseMackerel.landings = atlantis.landings[,"HorseMackerel"],
Whiting.landings = atlantis.landings[,"Whiting"],
CommonDab.landings = atlantis.landings[,"CommonDab"],
GreyGurnard.landings = atlantis.landings[,"GreyGurnard"],
Hake.landings = atlantis.landings[,"Hake"],
Shrimp.landings = atlantis.landings[,"Shrimp"],
#Abondance Age 1
# Sm_Plank_Fish.abund = atlantis.abundAge1[,"Sm_Plank_Fish"],
# Gadiods_Fish.abund = atlantis.abundAge1[,"Gadiods_Fish"],
# Raptors.abund = atlantis.abundAge1[,"Raptors"],
# Trans_Orcas.abund = atlantis.abundAge1[,"Trans_Orcas"],
# NorwayPout.abund = atlantis.abundAge1[,"NorwayPout"],
# Lrg_Phyto.abund = atlantis.abundAge1[,"Lrg_Phyto"],
# CommonSole.abund = atlantis.abundAge1[,"CommonSole"],
# Saithe.abund = atlantis.abundAge1[,"Saithe"],
# AtlanticCod.abund = atlantis.abundAge1[,"AtlanticCod"],
# Haddock.abund = atlantis.abundAge1[,"Haddock"],
# Whiting.abund = atlantis.abundAge1[,"Whiting"],
# Herring
Sm_Plank_Fish.meanSizeByAge1 = atlantis.meanSizeByAge$Sm_Plank_Fish[,2],
Sm_Plank_Fish.meanSizeByAge2 = atlantis.meanSizeByAge$Sm_Plank_Fish[,3],
Sm_Plank_Fish.meanSizeByAge3 = atlantis.meanSizeByAge$Sm_Plank_Fish[,4],
Sm_Plank_Fish.meanSizeByAge4 = atlantis.meanSizeByAge$Sm_Plank_Fish[,5],
Sm_Plank_Fish.meanSizeByAge5 = atlantis.meanSizeByAge$Sm_Plank_Fish[,6],
Sm_Plank_Fish.meanSizeByAge6 = atlantis.meanSizeByAge$Sm_Plank_Fish[,7],
Sm_Plank_Fish.meanSizeByAge7 = atlantis.meanSizeByAge$Sm_Plank_Fish[,8],
Sm_Plank_Fish.meanSizeByAge8 = atlantis.meanSizeByAge$Sm_Plank_Fish[,9],
Sm_Plank_Fish.meanSizeByAge9 = atlantis.meanSizeByAge$Sm_Plank_Fish[,10],
Sm_Plank_Fish.meanSizeByAge10 = atlantis.meanSizeByAge$Sm_Plank_Fish[,11],
Sm_Plank_Fish.meanSizeByAge11 = atlantis.meanSizeByAge$Sm_Plank_Fish[,12],
Sm_Plank_Fish.meanSizeByAge12 = atlantis.meanSizeByAge$Sm_Plank_Fish[,13],
Sm_Plank_Fish.meanSizeByAge13 = atlantis.meanSizeByAge$Sm_Plank_Fish[,14],
Sm_Plank_Fish.meanSizeByAge14 = atlantis.meanSizeByAge$Sm_Plank_Fish[,15],
# Mackerel
Gadiods_Fish.meanSizeByAge1 = atlantis.meanSizeByAge$Gadiods_Fish[,2],
Gadiods_Fish.meanSizeByAge2 = atlantis.meanSizeByAge$Gadiods_Fish[,3],
Gadiods_Fish.meanSizeByAge3 = atlantis.meanSizeByAge$Gadiods_Fish[,4],
Gadiods_Fish.meanSizeByAge4 = atlantis.meanSizeByAge$Gadiods_Fish[,5],
Gadiods_Fish.meanSizeByAge5 = atlantis.meanSizeByAge$Gadiods_Fish[,6],
Gadiods_Fish.meanSizeByAge6 = atlantis.meanSizeByAge$Gadiods_Fish[,7],
Gadiods_Fish.meanSizeByAge7 = atlantis.meanSizeByAge$Gadiods_Fish[,8],
Gadiods_Fish.meanSizeByAge8 = atlantis.meanSizeByAge$Gadiods_Fish[,9],
Gadiods_Fish.meanSizeByAge9 = atlantis.meanSizeByAge$Gadiods_Fish[,10],
Gadiods_Fish.meanSizeByAge10 = atlantis.meanSizeByAge$Gadiods_Fish[,11],
Gadiods_Fish.meanSizeByAge11 = atlantis.meanSizeByAge$Gadiods_Fish[,12],
Gadiods_Fish.meanSizeByAge12 = atlantis.meanSizeByAge$Gadiods_Fish[,13],
Gadiods_Fish.meanSizeByAge13 = atlantis.meanSizeByAge$Gadiods_Fish[,14],
Gadiods_Fish.meanSizeByAge14 = atlantis.meanSizeByAge$Gadiods_Fish[,15],
# Raptors
Raptors.meanSizeByAge1 = atlantis.meanSizeByAge$Raptors[,2],
Raptors.meanSizeByAge2 = atlantis.meanSizeByAge$Raptors[,3],
Raptors.meanSizeByAge3 = atlantis.meanSizeByAge$Raptors[,4],
Raptors.meanSizeByAge4 = atlantis.meanSizeByAge$Raptors[,5],
Raptors.meanSizeByAge5 = atlantis.meanSizeByAge$Raptors[,6],
Raptors.meanSizeByAge6 = atlantis.meanSizeByAge$Raptors[,7],
# Sprat
Trans_Orcas.meanSizeByAge1 = atlantis.meanSizeByAge$Trans_Orcas[,2],
Trans_Orcas.meanSizeByAge2 = atlantis.meanSizeByAge$Trans_Orcas[,3],
Trans_Orcas.meanSizeByAge3 = atlantis.meanSizeByAge$Trans_Orcas[,4],
Trans_Orcas.meanSizeByAge4 = atlantis.meanSizeByAge$Trans_Orcas[,5],
Trans_Orcas.meanSizeByAge5 = atlantis.meanSizeByAge$Trans_Orcas[,6],
Trans_Orcas.meanSizeByAge6 = atlantis.meanSizeByAge$Trans_Orcas[,7],
Trans_Orcas.meanSizeByAge7 = atlantis.meanSizeByAge$Trans_Orcas[,8],
Trans_Orcas.meanSizeByAge8 = atlantis.meanSizeByAge$Trans_Orcas[,9],
Trans_Orcas.meanSizeByAge9 = atlantis.meanSizeByAge$Trans_Orcas[,10],
Trans_Orcas.meanSizeByAge10 = atlantis.meanSizeByAge$Trans_Orcas[,11],
# Norway Pout
NorwayPout.meanSizeByAge1 = atlantis.meanSizeByAge$NorwayPout[,2],
NorwayPout.meanSizeByAge2 = atlantis.meanSizeByAge$NorwayPout[,3],
NorwayPout.meanSizeByAge3 = atlantis.meanSizeByAge$NorwayPout[,4],
NorwayPout.meanSizeByAge4 = atlantis.meanSizeByAge$NorwayPout[,5],
NorwayPout.meanSizeByAge5 = atlantis.meanSizeByAge$NorwayPout[,6],
# European Plaice
Lrg_Phyto.meanSizeByAge1 = atlantis.meanSizeByAge$Lrg_Phyto[,2],
Lrg_Phyto.meanSizeByAge2 = atlantis.meanSizeByAge$Lrg_Phyto[,3],
Lrg_Phyto.meanSizeByAge3 = atlantis.meanSizeByAge$Lrg_Phyto[,4],
Lrg_Phyto.meanSizeByAge4 = atlantis.meanSizeByAge$Lrg_Phyto[,5],
Lrg_Phyto.meanSizeByAge5 = atlantis.meanSizeByAge$Lrg_Phyto[,6],
Lrg_Phyto.meanSizeByAge6 = atlantis.meanSizeByAge$Lrg_Phyto[,7],
Lrg_Phyto.meanSizeByAge7 = atlantis.meanSizeByAge$Lrg_Phyto[,8],
Lrg_Phyto.meanSizeByAge8 = atlantis.meanSizeByAge$Lrg_Phyto[,9],
Lrg_Phyto.meanSizeByAge9 = atlantis.meanSizeByAge$Lrg_Phyto[,10],
Lrg_Phyto.meanSizeByAge10 = atlantis.meanSizeByAge$Lrg_Phyto[,11],
Lrg_Phyto.meanSizeByAge11 = atlantis.meanSizeByAge$Lrg_Phyto[,12],
Lrg_Phyto.meanSizeByAge12 = atlantis.meanSizeByAge$Lrg_Phyto[,13],
Lrg_Phyto.meanSizeByAge13 = atlantis.meanSizeByAge$Lrg_Phyto[,14],
Lrg_Phyto.meanSizeByAge14 = atlantis.meanSizeByAge$Lrg_Phyto[,15],
Lrg_Phyto.meanSizeByAge15 = atlantis.meanSizeByAge$Lrg_Phyto[,16],
Lrg_Phyto.meanSizeByAge16 = atlantis.meanSizeByAge$Lrg_Phyto[,17],
# Common sole
CommonSole.meanSizeByAge1 = atlantis.meanSizeByAge$CommonSole[,2],
CommonSole.meanSizeByAge2 = atlantis.meanSizeByAge$CommonSole[,3],
CommonSole.meanSizeByAge3 = atlantis.meanSizeByAge$CommonSole[,4],
CommonSole.meanSizeByAge4 = atlantis.meanSizeByAge$CommonSole[,5],
CommonSole.meanSizeByAge5 = atlantis.meanSizeByAge$CommonSole[,6],
CommonSole.meanSizeByAge6 = atlantis.meanSizeByAge$CommonSole[,7],
CommonSole.meanSizeByAge7 = atlantis.meanSizeByAge$CommonSole[,8],
CommonSole.meanSizeByAge8 = atlantis.meanSizeByAge$CommonSole[,9],
CommonSole.meanSizeByAge9 = atlantis.meanSizeByAge$CommonSole[,10],
CommonSole.meanSizeByAge10 = atlantis.meanSizeByAge$CommonSole[,11],
CommonSole.meanSizeByAge11 = atlantis.meanSizeByAge$CommonSole[,12],
CommonSole.meanSizeByAge12 = atlantis.meanSizeByAge$CommonSole[,13],
CommonSole.meanSizeByAge13 = atlantis.meanSizeByAge$CommonSole[,14],
# Saithe
Saithe.meanSizeByAge1 = atlantis.meanSizeByAge$Saithe[,2],
Saithe.meanSizeByAge2 = atlantis.meanSizeByAge$Saithe[,3],
Saithe.meanSizeByAge3 = atlantis.meanSizeByAge$Saithe[,4],
Saithe.meanSizeByAge4 = atlantis.meanSizeByAge$Saithe[,5],
Saithe.meanSizeByAge5 = atlantis.meanSizeByAge$Saithe[,6],
Saithe.meanSizeByAge6 = atlantis.meanSizeByAge$Saithe[,7],
Saithe.meanSizeByAge7 = atlantis.meanSizeByAge$Saithe[,8],
Saithe.meanSizeByAge8 = atlantis.meanSizeByAge$Saithe[,9],
Saithe.meanSizeByAge9 = atlantis.meanSizeByAge$Saithe[,10],
Saithe.meanSizeByAge10 = atlantis.meanSizeByAge$Saithe[,11],
Saithe.meanSizeByAge11 = atlantis.meanSizeByAge$Saithe[,12],
Saithe.meanSizeByAge12 = atlantis.meanSizeByAge$Saithe[,13],
Saithe.meanSizeByAge13 = atlantis.meanSizeByAge$Saithe[,14],
Saithe.meanSizeByAge14 = atlantis.meanSizeByAge$Saithe[,15],
Saithe.meanSizeByAge15 = atlantis.meanSizeByAge$Saithe[,16],
Saithe.meanSizeByAge16 = atlantis.meanSizeByAge$Saithe[,17],
Saithe.meanSizeByAge17 = atlantis.meanSizeByAge$Saithe[,18],
Saithe.meanSizeByAge18 = atlantis.meanSizeByAge$Saithe[,19],
Saithe.meanSizeByAge19 = atlantis.meanSizeByAge$Saithe[,20],
Saithe.meanSizeByAge20 = atlantis.meanSizeByAge$Saithe[,21],
# Cod
AtlanticCod.meanSizeByAge1 = atlantis.meanSizeByAge$AtlanticCod[,2],
AtlanticCod.meanSizeByAge2 = atlantis.meanSizeByAge$AtlanticCod[,3],
AtlanticCod.meanSizeByAge3 = atlantis.meanSizeByAge$AtlanticCod[,4],
AtlanticCod.meanSizeByAge4 = atlantis.meanSizeByAge$AtlanticCod[,5],
AtlanticCod.meanSizeByAge5 = atlantis.meanSizeByAge$AtlanticCod[,6],
AtlanticCod.meanSizeByAge6 = atlantis.meanSizeByAge$AtlanticCod[,7],
AtlanticCod.meanSizeByAge7 = atlantis.meanSizeByAge$AtlanticCod[,8],
AtlanticCod.meanSizeByAge8 = atlantis.meanSizeByAge$AtlanticCod[,9],
AtlanticCod.meanSizeByAge9 = atlantis.meanSizeByAge$AtlanticCod[,10],
AtlanticCod.meanSizeByAge10 = atlantis.meanSizeByAge$AtlanticCod[,11],
AtlanticCod.meanSizeByAge11 = atlantis.meanSizeByAge$AtlanticCod[,12],
AtlanticCod.meanSizeByAge12 = atlantis.meanSizeByAge$AtlanticCod[,13],
# Haddock
Haddock.meanSizeByAge1 = atlantis.meanSizeByAge$Haddock[,2],
Haddock.meanSizeByAge2 = atlantis.meanSizeByAge$Haddock[,3],
Haddock.meanSizeByAge3 = atlantis.meanSizeByAge$Haddock[,4],
Haddock.meanSizeByAge4 = atlantis.meanSizeByAge$Haddock[,5],
Haddock.meanSizeByAge5 = atlantis.meanSizeByAge$Haddock[,6],
Haddock.meanSizeByAge6 = atlantis.meanSizeByAge$Haddock[,7],
Haddock.meanSizeByAge7 = atlantis.meanSizeByAge$Haddock[,8],
Haddock.meanSizeByAge8 = atlantis.meanSizeByAge$Haddock[,9],
Haddock.meanSizeByAge9 = atlantis.meanSizeByAge$Haddock[,10],
# Horse Mackerel
HorseMackerel.meanSizeByAge1 = atlantis.meanSizeByAge$HorseMackerel[,2],
HorseMackerel.meanSizeByAge2 = atlantis.meanSizeByAge$HorseMackerel[,3],
HorseMackerel.meanSizeByAge3 = atlantis.meanSizeByAge$HorseMackerel[,4],
HorseMackerel.meanSizeByAge4 = atlantis.meanSizeByAge$HorseMackerel[,5],
HorseMackerel.meanSizeByAge5 = atlantis.meanSizeByAge$HorseMackerel[,6],
HorseMackerel.meanSizeByAge6 = atlantis.meanSizeByAge$HorseMackerel[,7],
HorseMackerel.meanSizeByAge7 = atlantis.meanSizeByAge$HorseMackerel[,8],
HorseMackerel.meanSizeByAge8 = atlantis.meanSizeByAge$HorseMackerel[,9],
HorseMackerel.meanSizeByAge9 = atlantis.meanSizeByAge$HorseMackerel[,10],
HorseMackerel.meanSizeByAge10 = atlantis.meanSizeByAge$HorseMackerel[,11],
HorseMackerel.meanSizeByAge11 = atlantis.meanSizeByAge$HorseMackerel[,12],
HorseMackerel.meanSizeByAge12 = atlantis.meanSizeByAge$HorseMackerel[,13],
# Whiting
Whiting.meanSizeByAge1 = atlantis.meanSizeByAge$Whiting[,2],
Whiting.meanSizeByAge2 = atlantis.meanSizeByAge$Whiting[,3],
Whiting.meanSizeByAge3 = atlantis.meanSizeByAge$Whiting[,4],
Whiting.meanSizeByAge4 = atlantis.meanSizeByAge$Whiting[,5],
Whiting.meanSizeByAge5 = atlantis.meanSizeByAge$Whiting[,6],
Whiting.meanSizeByAge6 = atlantis.meanSizeByAge$Whiting[,7],
Whiting.meanSizeByAge7 = atlantis.meanSizeByAge$Whiting[,8],
Whiting.meanSizeByAge8 = atlantis.meanSizeByAge$Whiting[,9],
Whiting.meanSizeByAge9 = atlantis.meanSizeByAge$Whiting[,10],
Whiting.meanSizeByAge10 = atlantis.meanSizeByAge$Whiting[,11],
# Dab
CommonDab.meanSizeByAge1 = atlantis.meanSizeByAge$CommonDab[,2],
CommonDab.meanSizeByAge2 = atlantis.meanSizeByAge$CommonDab[,3],
CommonDab.meanSizeByAge3 = atlantis.meanSizeByAge$CommonDab[,4],
CommonDab.meanSizeByAge4 = atlantis.meanSizeByAge$CommonDab[,5],
CommonDab.meanSizeByAge5 = atlantis.meanSizeByAge$CommonDab[,6],
CommonDab.meanSizeByAge6 = atlantis.meanSizeByAge$CommonDab[,7],
CommonDab.meanSizeByAge7 = atlantis.meanSizeByAge$CommonDab[,8],
CommonDab.meanSizeByAge8 = atlantis.meanSizeByAge$CommonDab[,9],
CommonDab.meanSizeByAge9 = atlantis.meanSizeByAge$CommonDab[,10],
# Grey Gurnard
GreyGurnard.meanSizeByAge1 = atlantis.meanSizeByAge$GreyGurnard[,2],
GreyGurnard.meanSizeByAge2 = atlantis.meanSizeByAge$GreyGurnard[,3],
GreyGurnard.meanSizeByAge3 = atlantis.meanSizeByAge$GreyGurnard[,4],
GreyGurnard.meanSizeByAge4 = atlantis.meanSizeByAge$GreyGurnard[,5],
GreyGurnard.meanSizeByAge5 = atlantis.meanSizeByAge$GreyGurnard[,6],
GreyGurnard.meanSizeByAge6 = atlantis.meanSizeByAge$GreyGurnard[,7],
GreyGurnard.meanSizeByAge7 = atlantis.meanSizeByAge$GreyGurnard[,8],
GreyGurnard.meanSizeByAge8 = atlantis.meanSizeByAge$GreyGurnard[,9],
GreyGurnard.meanSizeByAge9 = atlantis.meanSizeByAge$GreyGurnard[,10],
GreyGurnard.meanSizeByAge10 = atlantis.meanSizeByAge$GreyGurnard[,11],
GreyGurnard.meanSizeByAge11 = atlantis.meanSizeByAge$GreyGurnard[,12],
GreyGurnard.meanSizeByAge12 = atlantis.meanSizeByAge$GreyGurnard[,13],
# Hake
Hake.meanSizeByAge1 = atlantis.meanSizeByAge$Hake[,2],
Hake.meanSizeByAge2 = atlantis.meanSizeByAge$Hake[,3],
Hake.meanSizeByAge3 = atlantis.meanSizeByAge$Hake[,4],
Hake.meanSizeByAge4 = atlantis.meanSizeByAge$Hake[,5],
Hake.meanSizeByAge5 = atlantis.meanSizeByAge$Hake[,6],
Hake.meanSizeByAge6 = atlantis.meanSizeByAge$Hake[,7],
Hake.meanSizeByAge7 = atlantis.meanSizeByAge$Hake[,8],
Hake.meanSizeByAge8 = atlantis.meanSizeByAge$Hake[,9],
Hake.meanSizeByAge9 = atlantis.meanSizeByAge$Hake[,10])
Sm_Plank_Fish.biomass = atlantis.biomass[,"Sm_Plank_Fish"]
atlantis.biomass[,"Sm_Plank_Fish"]
atlantis.biomass["Sm_Plank_Fish"]
atlantis.meanSizeByAge = outputs$waa
outputs <- read_atlantis(path = path, prefix = prefix, fg.file = fg.file)
atlantis.meanSizeByAge = outputs$waa
atlantis.meanSizeByAge
##########################################################################################
# Process the outputs so that calibrar like them
output = list(
# Biomass
Sm_Plank_Fish.biomass = atlantis.biomass["Sm_Plank_Fish"],
Gadiods_Fish.biomass = atlantis.biomass["Gadiods_Fish"],
Raptors.biomass = atlantis.biomass["Raptors"],
Trans_Orcas.biomass = atlantis.biomass["Trans_Orcas"],
Lrg_Phyto.biomass = atlantis.biomass["Lrg_Phyto"],
Sm_Phyto.biomass = atlantis.biomass["Sm_Phyto"],
Micro_Zoo.biomass = atlantis.biomass["Micro_Zoo"],
Meso_Zoo.biomass = atlantis.biomass["Meso_Zoo"],
Lrg_Zoo.biomass = atlantis.biomass["Lrg_Zoo"],
Gel_Zoo.biomass = atlantis.biomass["Gel_Zoo"],
Macroalgae.biomass = atlantis.biomass["Macroalgae"],
Seagrass.biomass = atlantis.biomass["Seagrass"],
Bivalve.biomass = atlantis.biomass["Bivalve"],
Sed_Bact.biomass = atlantis.biomass["Sed_Bact"],
Pelag_Bact.biomass = atlantis.biomass["Pelag_Bact"],
# Thr
# Sm_Plank_Fish.Thr = atlantis.biomass["Sm_Plank_Fish"],
# Gadiods_Fish.Thr = atlantis.biomass["Gadiods_Fish"],
# Raptors.Thr = atlantis.biomass["Raptors"],
# Trans_Orcas.Thr = atlantis.biomass["Trans_Orcas"],
# Sm_Phyto.Thr = atlantis.biomass["Sm_Phyto"],
# Lrg_Phyto.Thr = atlantis.biomass["Lrg_Phyto"],
# Micro_Zoo.Thr = atlantis.biomass["Micro_Zoo"],
# Meso_Zoo.Thr = atlantis.biomass["Meso_Zoo"],
# Lrg_Zoo.Thr = atlantis.biomass["Lrg_Zoo"],
# Gel_Zoo.Thr = atlantis.biomass["Gel_Zoo"],
# Macroalgae.Thr = atlantis.biomass["Macroalgae"],
# Seagrass.Thr = atlantis.biomass["Seagrass"],
# Bivalve.Thr = atlantis.biomass["Bivalve"],
# Sed_Bact.Thr = atlantis.biomass["Sed_Bact"],
# Pelag_Bact.Thr = atlantis.biomass["Pelag_Bact"],
# Landings
# Sm_Plank_Fish.landings = atlantis.landings["Sm_Plank_Fish"],
# Gadiods_Fish.landings = atlantis.landings["Gadiods_Fish"],
# Meso_Zoo.landings = atlantis.landings["Meso_Zoo"],
# Lrg_Zoo.landings = atlantis.landings["Lrg_Zoo"],
# Macroalgae.landings = atlantis.landings["Macroalgae"],
# Seagrass.landings = atlantis.landings["Seagrass"],
# Bivalve.landings = atlantis.landings["Bivalve"],
#Abundance
Sm_Plank_Fish.abundance = atlantis.abundance["Sm_Plank_Fish"],
Gadiods_Fish.abundance  = atlantis.abundance["Gadiods_Fish"],
Raptors.abundance  = atlantis.abundance["Raptors"],
Trans_Orcas.abundance = atlantis.abundance["Trans_Orcas"],
# Waa Sm_Plank_Fish
Sm_Plank_Fish.meanSizeByAge1 = atlantis.meanSizeByAge["Sm_Plank_Fish1_StructN"],
Sm_Plank_Fish.meanSizeByAge2 = atlantis.meanSizeByAge["Sm_Plank_Fish2_StructN"],
Sm_Plank_Fish.meanSizeByAge3 = atlantis.meanSizeByAge["Sm_Plank_Fish3_StructN"],
Sm_Plank_Fish.meanSizeByAge4 = atlantis.meanSizeByAge["Sm_Plank_Fish4_StructN"],
Sm_Plank_Fish.meanSizeByAge5 = atlantis.meanSizeByAge["Sm_Plank_Fish5_StructN"],
Sm_Plank_Fish.meanSizeByAge6 = atlantis.meanSizeByAge["Sm_Plank_Fish6_StructN"],
Sm_Plank_Fish.meanSizeByAge7 = atlantis.meanSizeByAge["Sm_Plank_Fish7_StructN"],
Sm_Plank_Fish.meanSizeByAge8 = atlantis.meanSizeByAge["Sm_Plank_Fish8_StructN"],
# Waa Gadiods_Fish
Gadiods_Fish.meanSizeByAge1 = atlantis.meanSizeByAge["Gadiods_Fish1_StructN"],
Gadiods_Fish.meanSizeByAge2 = atlantis.meanSizeByAge["Gadiods_Fish2_StructN"],
Gadiods_Fish.meanSizeByAge3 = atlantis.meanSizeByAge["Gadiods_Fish3_StructN"],
Gadiods_Fish.meanSizeByAge4 = atlantis.meanSizeByAge["Gadiods_Fish4_StructN"],
Gadiods_Fish.meanSizeByAge5 = atlantis.meanSizeByAge["Gadiods_Fish5_StructN"],
Gadiods_Fish.meanSizeByAge6 = atlantis.meanSizeByAge["Gadiods_Fish6_StructN"],
Gadiods_Fish.meanSizeByAge7 = atlantis.meanSizeByAge["Gadiods_Fish7_StructN"],
Gadiods_Fish.meanSizeByAge8 = atlantis.meanSizeByAge["Gadiods_Fish8_StructN"],
Gadiods_Fish.meanSizeByAge9 = atlantis.meanSizeByAge["Gadiods_Fish9_StructN"],
Gadiods_Fish.meanSizeByAge10 = atlantis.meanSizeByAge["Gadiods_Fish10_StructN"],
# Waa Raptors
Raptors.meanSizeByAge1 = atlantis.meanSizeByAge["Raptors1_StructN"],
Raptors.meanSizeByAge2 = atlantis.meanSizeByAge["Raptors2_StructN"],
Raptors.meanSizeByAge3 = atlantis.meanSizeByAge["Raptors3_StructN"],
Raptors.meanSizeByAge4 = atlantis.meanSizeByAge["Raptors4_StructN"],
Raptors.meanSizeByAge5 = atlantis.meanSizeByAge["Raptors5_StructN"],
Raptors.meanSizeByAge6 = atlantis.meanSizeByAge["Raptors6_StructN"],
Raptors.meanSizeByAge7 = atlantis.meanSizeByAge["Raptors7_StructN"],
Raptors.meanSizeByAge8 = atlantis.meanSizeByAge["Raptors8_StructN"],
Raptors.meanSizeByAge9 = atlantis.meanSizeByAge["Raptors9_StructN"],
Raptors.meanSizeByAge10 = atlantis.meanSizeByAge["Raptors10_StructN"],
# Waa Trans orcas
Trans_Orcas.meanSizeByAge1 = atlantis.meanSizeByAge["Trans_Orcas1_StructN"],
Trans_Orcas.meanSizeByAge2 = atlantis.meanSizeByAge["Trans_Orcas2_StructN"],
Trans_Orcas.meanSizeByAge3 = atlantis.meanSizeByAge["Trans_Orcas3_StructN"],
Trans_Orcas.meanSizeByAge4 = atlantis.meanSizeByAge["Trans_Orcas4_StructN"],
Trans_Orcas.meanSizeByAge5 = atlantis.meanSizeByAge["Trans_Orcas5_StructN"],
Trans_Orcas.meanSizeByAge6 = atlantis.meanSizeByAge["Trans_Orcas6_StructN"],
Trans_Orcas.meanSizeByAge7 = atlantis.meanSizeByAge["Trans_Orcas7_StructN"],
Trans_Orcas.meanSizeByAge8 = atlantis.meanSizeByAge["Trans_Orcas8_StructN"],
Trans_Orcas.meanSizeByAge9 = atlantis.meanSizeByAge["Trans_Orcas9_StructN"],
Trans_Orcas.meanSizeByAge10 = atlantis.meanSizeByAge["Trans_Orcas10_StructN"])
View(output)
##########################################################################################
# Parameter transformation
bio.prm = "AMPSbioparam_mv1_2022.prm"
edit_param_mum_sp(bio.prm, 2, "TOR")
getwd()
mum.factor
library("osmose")
library("ncdf4")
setwd("C:/Users/Alaia/Desktop/osmose-ns/Bioen-OSMOSE-NS - 4.3.3 - FISHMIP")
setwd("C:/Users/Alaia/Desktop/osmose-ns/Bioen-OSMOSE-NS - 4.3.3 - Morell et al. 2023")
setwd("C:/Users/Alaia/Desktop/These/Survey_Evo_Maia/Ev-osmose_CC_evo")
# run the osmose model
#osmose = "C:/Users/amorell/Desktop/Evo-osmose_git/dist/alaia_bioen.jar"
osmose = "C:/Users/Alaia/Desktop/osmose_4.3.3-jar-with-dependencies.jar"
osmose = "C:/Users/Alaia/Desktop/osmose-private/target/osmose_4.3.3.jar"
run_osmose("calib_config.csv", osmose = osmose, output = "output")
45000/60
750/60
##########################################################################################
# read Atlantis outputs
path = ""
prefix = "AMPS"
bio.prm = "AMPSbioparam_mv1_2022.prm"
fg.file <- "PugetSoundAtlantisFunctionalGroups_salmon_rectype4.csv"
outputs <- read_atlantis(path = path, prefix = prefix, fg.file = fg.file)
devtools::load_all("C:/Users/Alaia/Desktop/Postdoc/R script/atlantis2ls")
outputs <- read_atlantis(path = path, prefix = prefix, fg.file = fg.file)
#demo
path = "C:/Users/Alaia/Desktop/Postdoc/R script/atlantis2ls/data"
prefix = "AMPS"
fg.file = "C:/Users/Alaia/Desktop/Postdoc/R script/atlantis2ls/data/PugetSoundAtlantisFunctionalGroups_salmon_rectype4.csv"
bio.prm = "C:/Users/Alaia/Desktop/Postdoc/R script/atlantis2ls/data/AMPSbioparam_mv1_2022.prm"
bio.prm2 = "C:/Users/Alaia/Desktop/Postdoc/R script/atlantis2ls/data/AMPSbioparam_mv1_20222.prm"
a <- read_atlantis(path = path, prefix = prefix, fg.file = fg.file)
